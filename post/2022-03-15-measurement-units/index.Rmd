---
title: measurement units
author: KwH Kim
date: '2022-03-15'
slug: measurement-units
categories: ["R"]
tags: ["visualization", "preprocessing"]
output: html_document
---

```{r setup, include=FALSE}
###tags=시각화,EDA,빅데이터
###category=R,시각화
#knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
#knitr::opts_chunk$set(out.width='70%', fig.show='hold')
#knitr::opts_chunk$set(dev = "png", dev.args = list(type = "cairo-png"))
# https://www.jumpingrivers.com/blog/r-knitr-markdown-png-pdf-graphics/
#knitr::opts_chunk$set(dev = 'png')
```

Data `mtcars` has a column named `mpg`. `mpg` means **m**iles **p**er **g**allon. 'Mile' and 'gallon' are units for length and volume. A mile is approximately 1.6 kilometers and a gallon is approximately 3.7 liters. Mile and gallon sound unfamiliar to people who live outside England or U.S.A. because international standard units for length and volume are meter and liter.

In this post, we will learn how to convert a unit to another unit, for instance, we will convert mpg to km/L, which is more comprehensible to people who use SI units.[^si] 

[^si]: [International System of Units](https://en.wikipedia.org/wiki/International_System_of_Units)

## Units in R

Vectors(the most common data structure in R) do not contain information of measurement units. Units are implicit and units should be converted by users. But as history tells us, unit conversion should be treated carefully because it can cause serious damage to the whole project[^ex].

## Package `units`

Using the package `units`, we can easily convert units accurately. And the data is plotted, units will be included in the x- or y-label automatically.

First install package `units`.

```{r, eval=FALSE}
install.packages('units')
```

And load all the necessary packages and data

```{r}
library(units)
library(dplyr, warn.conflicts = FALSE)
data(mtcars)
```

To get the information about the data `mtcars`, we can do `help(mtcars)`. It will show the measurement unit for each column. `mpg` is measured in unit of  **m**iles **p**er **g**allon, `disp` is measured in unit of cubic inch, `hp` is measured in unit of gross **h**orse**p**ower, `wt` is measured in unit of 1000 lbs, and `qsec` is measured in unit of sec per 1/4 mile.

It is sad that mpg(**m**iles **p**er **g**allon) is not registered in the package `units`, but we can register it ourselves. The code below installs a new unit called `mpg_US` as `interantional_mile/US_liquid_gallon`.

```{r}
install_unit(name='mpg_US', def='international_mile/US_liquid_gallon')
```

Now we can use `mpg_US`. `mtcars$mpg` is measured in unit of mpg(US) and `mtcars$wt` is measured in unit of kilogram.

```{r}
units(mtcars$mpg) = 'mpg_US'
units(mtcars$wt) = 'kg'
mtcars$mpg %>% head
```

If we want to convert the unit mpg(US) to SI unit km/L, we need to do the below.[^compare]

```{r}
units(mtcars$mpg) = 'km/L'
mtcars$mpg %>% head
```

We can easily plot the relation between `mpg` and `wt` using the package `ggplot2`. But do not forget to load `ggforce` beforehand.

```{r}
library(ggplot2)
library(ggforce) # without this, the code below will raise error!
ggplot(data=mtcars,
       aes(x=mpg, y=wt)) + 
  geom_point()
```

## Summary

Use `units::units()<-` for setting unit for measurements.
Use `install_unit(name=, def=)` for introducing new units.
Use `valid_udunits()` to show all the units available from the package `units`.

```{r}
valid_udunits() %>% head 
```





[^ex]: It is well known that the failure of MCO(**M**ars **C**limate **O**rbiter) is due to inadequate unit coversion.

[^compare]: If the objective is simply to reset the unit, do `units(mtcars$mpg)=NULL; units(mtcars$mpg)='km/L'`. This will not convert unit but just replace the unit with another unit.
